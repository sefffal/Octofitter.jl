<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Basic Astrom Fit · Octofitter.jl</title><meta name="title" content="Basic Astrom Fit · Octofitter.jl"/><meta property="og:title" content="Basic Astrom Fit · Octofitter.jl"/><meta property="twitter:title" content="Basic Astrom Fit · Octofitter.jl"/><meta name="description" content="Documentation for Octofitter.jl."/><meta property="og:description" content="Documentation for Octofitter.jl."/><meta property="twitter:description" content="Documentation for Octofitter.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="Octofitter.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">Octofitter.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../quick-start/">Quick Start</a></li><li><a class="tocitem" href="../migration/">Migration Guide</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox" checked/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Relative Astrometry</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Basic Astrom Fit</a></li><li><a class="tocitem" href="../rel-astrom-obs/">Observable Priors</a></li><li><a class="tocitem" href="../fit-coplanar/">Resonant Co-Planar Model</a></li><li><a class="tocitem" href="../thiele-innes/">Thiele-Innes Parameters</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Radial Velocity</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../rv-1/">Basic RV Fit</a></li><li><a class="tocitem" href="../rv-gp/">Gaussian Process</a></li><li><a class="tocitem" href="../rv-multi-planet/">Multiple Planets</a></li><li><a class="tocitem" href="../fit-rv-rel/">Relative RV Data</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Absolute Astrometry</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../pma/">Proper Motion Anomaly</a></li><li><a class="tocitem" href="../hipparcos/">Hipparcos IAD</a></li><li><a class="tocitem" href="../gaia-iad/">Gaia DR4 IAD</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Images and More</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../images/">Image Data (de-orbiting)</a></li><li><a class="tocitem" href="../extract-phot-astrom/">Extract Astrom. and Photometry</a></li><li><a class="tocitem" href="../mass-photometry/">Connect Mass and Photometry</a></li><li><a class="tocitem" href="../fit-interfere/">Interferometer Data</a></li><li><a class="tocitem" href="../fit-likemap/">Likelihood Map</a></li><li><a class="tocitem" href="../fit-grav-wide/">GRAVITY Wide Data</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Joint Models</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../astrom-pma-rv/">Astrometry, PMA, and RV</a></li><li><a class="tocitem" href="../fit-rv-astrom/">RV and Relative Astrometry</a></li><li><a class="tocitem" href="../rv/">RV and Proper Motion Anomaly</a></li><li><a class="tocitem" href="../limits/">Calculate Detection Limits</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6" type="checkbox"/><label class="tocitem" for="menuitem-3-6"><span class="docs-label">Bayesian Workflows</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../data-simulation/">Generating and Fitting Simulated Data</a></li><li><a class="tocitem" href="../prior-pred/">Prior Predictive Checks</a></li><li><a class="tocitem" href="../post-pred/">Posterior Predictive Checks</a></li><li><a class="tocitem" href="../cross-validation/">Cross Validation</a></li><li><a class="tocitem" href="../sbc/">Simulation Based Calibration</a></li></ul></li></ul></li><li><span class="tocitem">Documentation</span><ul><li><a class="tocitem" href="../python/">Using Python</a></li><li><a class="tocitem" href="../chains/">Chains</a></li><li><a class="tocitem" href="../octoplot/">Orbit plots with <code>octoplot</code></a></li><li><a class="tocitem" href="../rvpostplot/">RV plots with <code>rvpostplot</code></a></li><li><a class="tocitem" href="../loading-saving/">Loading and Saving Data</a></li><li><a class="tocitem" href="../samplers/">Sampler</a></li><li><a class="tocitem" href="../parallel-sampling/">Distributed Sampling</a></li><li><a class="tocitem" href="../priors/">Priors</a></li><li><a class="tocitem" href="../derived/">Derived Variables</a></li><li><a class="tocitem" href="../custom-likelihood/">Custom Likelihoods</a></li><li><a class="tocitem" href="../kepler/">Kepler Solver</a></li><li><a class="tocitem" href="../compat-orbitize/">Orbitize! Compatibility</a></li><li><a class="tocitem" href="../api/">Full API Documentation</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li><a class="is-disabled">Relative Astrometry</a></li><li class="is-active"><a href>Basic Astrom Fit</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Basic Astrom Fit</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/sefffal/Octofitter.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/sefffal/Octofitter.jl/blob/main/docs/src/rel-astrom.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="fit-astrometry"><a class="docs-heading-anchor" href="#fit-astrometry">Basic Astrometry Fit</a><a id="fit-astrometry-1"></a><a class="docs-heading-anchor-permalink" href="#fit-astrometry" title="Permalink"></a></h1><p>Here is a worked example of a one-planet model fit to relative astrometry (positions measured between the planet and the host star). </p><p>Start by loading the Octofitter and Distributions packages:</p><pre><code class="language-julia hljs">using Octofitter, Distributions</code></pre><h3 id="Specifying-the-data"><a class="docs-heading-anchor" href="#Specifying-the-data">Specifying the data</a><a id="Specifying-the-data-1"></a><a class="docs-heading-anchor-permalink" href="#Specifying-the-data" title="Permalink"></a></h3><p>We will create a likelihood object to contain our relative astrometry data. We can specify this data in several formats. It can be listed in the code or loaded from a file (eg. a CSV file, FITS table, or SQL database). You can use any Julia table object.</p><pre><code class="language-julia hljs">astrom_dat_1 = Table(;
    epoch= [50000,  50120, 50240, 50360,50480, 50600, 50720, 50840,], # MJD (days)
    ra   = [-505.764, -502.57, -498.209, -492.678,-485.977, -478.11, -469.08, -458.896,], # mas
    dec  = [-66.9298, -37.4722, -7.92755, 21.6356, 51.1472,  80.5359,  109.729,  138.651, ], # mas
    # Tip! Type this as \sigma + &lt;TAB key&gt;!
    σ_ra = [10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0, ],  # mas
    σ_dec = [10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0, ], # mas
    cor =  [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, ]
)
astrom_like_1 = PlanetRelAstromLikelihood(astrom_dat_1, name=&quot;relastrom&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PlanetRelAstromLikelihood Table with 6 columns and 8 rows:
     epoch  ra        dec       σ_ra  σ_dec  cor
   ┌────────────────────────────────────────────
 1 │ 50000  -505.764  -66.9298  10.0  10.0   0.0
 2 │ 50120  -502.57   -37.4722  10.0  10.0   0.0
 3 │ 50240  -498.209  -7.92755  10.0  10.0   0.0
 4 │ 50360  -492.678  21.6356   10.0  10.0   0.0
 5 │ 50480  -485.977  51.1472   10.0  10.0   0.0
 6 │ 50600  -478.11   80.5359   10.0  10.0   0.0
 7 │ 50720  -469.08   109.729   10.0  10.0   0.0
 8 │ 50840  -458.896  138.651   10.0  10.0   0.0</code></pre><p>In Octofitter, <code>epoch</code> is always the modified Julian date (measured in days). If you&#39;re not sure what this is, you can get started by just putting in arbitrary time offsets measured in days.</p><p>In this case, we specified <code>ra</code> and <code>dec</code> offsets in milliarcseconds. We could instead specify <code>sep</code> (projected separation) in milliarcseconds and <code>pa</code> in radians. You cannot mix the two formats in a single <code>PlanetRelAstromLikelihood</code> but you can create two different likelihood objects, one for each format, and add them both to your model:</p><p>You can also specify it in separation (mas) and positon angle (rad):</p><pre><code class="language-julia hljs">astrom_dat_2 = Table(
    epoch = [42000, ], # MJD
    sep = [505.7637580573554, ], # mas
    pa = [deg2rad(24.1), ], # radians
    # Tip! Type this as \sigma + &lt;TAB key&gt;!
    σ_sep = [70, ],
    σ_pa = [deg2rad(10.2), ],
)
astrom_like_2 = PlanetRelAstromLikelihood(astrom_dat_2, name=&quot;relastrom2&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PlanetRelAstromLikelihood Table with 5 columns and 1 row:
     epoch  sep      pa        σ_sep  σ_pa
   ┌──────────────────────────────────────────
 1 │ 42000  505.764  0.420624  70     0.178024</code></pre><div class="admonition is-info" id="Note-9a2793efc9bbe4d5"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-9a2793efc9bbe4d5" title="Permalink"></a></header><div class="admonition-body"><p>Tip: You can load data from a CSV file:</p><pre><code class="language-julia hljs">using CSV
astrom_dat = CSV.read(&quot;mydata.csv&quot;, Table)</code></pre></div></div><h4 id="Advanced-Options"><a class="docs-heading-anchor" href="#Advanced-Options">Advanced Options</a><a id="Advanced-Options-1"></a><a class="docs-heading-anchor-permalink" href="#Advanced-Options" title="Permalink"></a></h4><p>You can group your data in different likelihood objects, each with their own instrument name. Each group can have its own <code>platescale</code>, <code>northangle</code>, and astrometric <code>jitter</code> variables for modelling instrument-specific systematics.</p><pre><code class="language-julia hljs">astrom_like_1 = PlanetRelAstromLikelihood(
    astrom_dat_1,
    name = &quot;GPI astrom&quot;,
    variables = @variables begin
        jitter ~ Uniform(0, 10) # mas [optional]
        northangle ~ Normal(0, deg2rad(1)) # radians of offset [optional]
        platescale ~ truncated(Normal(1, 0.01), lower=0) # 1% relative platescale uncertainty
    end
)

astrom_like_2 = PlanetRelAstromLikelihood(
    astrom_dat_2,
    name = &quot;SPHERE astrom&quot;,
    variables = @variables begin
        jitter ~ Uniform(0, 10) # mas [optional]
        northangle ~ Normal(0, deg2rad(1)) # radians of offset [optional]
        platescale ~ truncated(Normal(1, 0.01), lower=0) # 1% relative platescale uncertainty
    end
)</code></pre><p>In Octofitter, <code>epoch</code> is always the modified Julian date (measured in days). If you&#39;re not sure what this is, you can get started by just putting in arbitrary time offsets measured in days.</p><p>In this case, we specified <code>ra</code> and <code>dec</code> offsets in milliarcseconds. We could instead specify <code>sep</code> (projected separation) in milliarcseconds and <code>pa</code> in radians. You cannot mix the two formats in a single <code>PlanetRelAstromLikelihood</code> but you can create two different likelihood objects, one for each format.</p><h3 id="Creating-a-planet"><a class="docs-heading-anchor" href="#Creating-a-planet">Creating a planet</a><a id="Creating-a-planet-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-a-planet" title="Permalink"></a></h3><p>We now create our first planet model. Let&#39;s name it planet <code>b</code>.  The name of the planet will be used in the output results.</p><p>In Octofitter, we specify planet and system models using a &quot;probabilistic programming language&quot;. Quantities with a <code>~</code> are random variables. The distributions on the right hand sides are <strong>priors</strong>. You must specify a  proper prior for any quantity which is allowed to vary. </p><p>We now create a planet model incorporating our likelihoods and specify our priors.</p><pre><code class="language-julia hljs">planet_1 = Planet(
    name=&quot;b&quot;,
    basis=Visual{KepOrbit},
    likelihoods=[astrom_like_1, astrom_like_2],
    variables=@variables begin
        plx = system.plx
        M ~ truncated(Normal(1.2, 0.1), lower=0.1)
        a ~ Uniform(0, 100)
        e ~ Uniform(0.0, 0.5)
        i ~ Sine()
        ω ~ UniformCircular()
        Ω ~ UniformCircular()
        θ ~ UniformCircular()
        tp = θ_at_epoch_to_tperi(θ, 50420; M, e, a, i, ω, Ω)
    end
)</code></pre><p><strong><code>name</code></strong>: Try to give your companion a short name consisting only of letters and/or trailing numbers.</p><p><strong><code>basis</code></strong>: <code>Visual{KepOrbit}</code> is the type of orbit parameterization. There are several options available in the <a href="https://sefffal.github.io/PlanetOrbits.jl/dev/api/">PlanetOrbits.jl documentation</a>. The basis controls how how the orbit is calculated and what variables must be supplied.</p><p><strong><code>likelihoods</code></strong>: A list of zero or more likelihood objects containing our data</p><p><strong><code>variables</code></strong>: The variables block specifies our priors. You must supply every variable needed by your chosen <code>basis</code>, in this case:</p><ul><li><code>M</code>, the total mass of the system in solar masses</li><li><code>plx</code>, the parallax distance to the system in milliarseconds</li><li><code>a</code>: Semi-major axis, astronomical units (AU)</li><li><code>i</code>: Inclination, radians</li><li><code>e</code>: Eccentricity in the range [0, 1)</li><li><code>ω</code>: Argument of periastron, radius</li><li><code>Ω</code>: Longitude of the ascending node, radians.</li><li><code>tp</code>: Epoch of periastron passage</li></ul><p>Priors can be any distribution from the Distributions.jl package.</p><p>Many different distributions are supported as priors, including <code>Uniform</code>, <code>LogNormal</code>, <code>LogUniform</code>, <code>Sine</code>, and <code>Beta</code>. See the section on <a href="../priors/#priors">Priors</a> for more information. The parameters can be specified in any order.</p><p>You can also hardcode a particular value for any parameter if you don&#39;t want it to vary. Simply replace eg. <code>e ~ Uniform(0, 0.999)</code> with <code>e = 0.1</code>. This <code>=</code> syntax works for arbitrary mathematical expressions and even functions. We use it here to reparameterize <code>tp</code> as a function of the planet&#39;s position angle on a given date. The <code>=</code> syntax also works to access variables from higher levels of the system.</p><div class="admonition is-warning" id="Warning-ee3e0ba068107963"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-ee3e0ba068107963" title="Permalink"></a></header><div class="admonition-body"><p>You must specify a proper prior for any quantity which is allowed to vary.  &quot;Uninformative&quot; priors like <code>1/x</code> must be given bounds, and can be specified with <code>LogUniform(lower, upper)</code>.</p></div></div><div class="admonition is-warning" id="Warning-9adc3c52ef040507"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-9adc3c52ef040507" title="Permalink"></a></header><div class="admonition-body"><p>Make sure that variables like mass and eccentricity can&#39;t be negative. You can pass a distribution to <code>truncated</code> to prevent this, e.g. <code>M ~ truncated(Normal(1, 0.1),lower=0)</code>.</p></div></div><h3 id="Creating-a-system"><a class="docs-heading-anchor" href="#Creating-a-system">Creating a system</a><a id="Creating-a-system-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-a-system" title="Permalink"></a></h3><p>Now, we add our planets to a &quot;system&quot;. Properties of the whole system are specified here, like parallax distance. For multi-planet systems, it makes sense to create shared variables here for e.g. the mass of the primary which is then used in all planet models. This is also where you will supply data like images, astrometric acceleration, or stellar radial velocity since they don&#39;t belong to any planet in particular.</p><pre><code class="language-julia hljs">sys = System(
    name = &quot;Tutoria&quot;,
    companions=[planet_1],
    likelihoods=[],
    variables=@variables begin
        plx ~ truncated(Normal(50.0, 0.02), lower=0.1)
    end
)</code></pre><div class="admonition is-info" id="Note-7f6baa1ea74a30b0"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-7f6baa1ea74a30b0" title="Permalink"></a></header><div class="admonition-body"><p>The name of your system will be used for various output file names by default – we suggest naming it something like <code>&quot;PDS70-astrom-model-v1&quot;</code>.</p></div></div><p>The variables block works just like it does for planets. Here, we provided the parallax distance to the system:</p><ul><li><code>plx</code>: Distance to the system expressed in milliarcseconds of parallax.</li></ul><h3 id="Prepare-model"><a class="docs-heading-anchor" href="#Prepare-model">Prepare model</a><a id="Prepare-model-1"></a><a class="docs-heading-anchor-permalink" href="#Prepare-model" title="Permalink"></a></h3><p>We now convert our declarative model into efficient, compiled code:</p><pre><code class="language-julia hljs">model = Octofitter.LogDensityModel(sys)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">LogDensityModel for System Tutoria of dimension 17 and 12 epochs with fields .ℓπcallback and .∇ℓπcallback
</code></pre><p>This type implements the julia LogDensityProblems.jl interface and can be passed to a wide variety of samplers.</p><h3 id="Initialize-starting-points-for-chains"><a class="docs-heading-anchor" href="#Initialize-starting-points-for-chains">Initialize starting points for chains</a><a id="Initialize-starting-points-for-chains-1"></a><a class="docs-heading-anchor-permalink" href="#Initialize-starting-points-for-chains" title="Permalink"></a></h3><p>Run the <code>initialize!</code> function to find good starting points for the chain. You can provide guesses for parameters if you want to.</p><pre><code class="language-julia hljs">init_chain = initialize!(model) # No guesses provided, slower global optimization will be used</code></pre><pre><code class="language-julia hljs">init_chain = initialize!(model, (;
    plx = 50,
    planets = (;
        b=(;
            M = 1.21,
            a = 10.0,
            e = 0.01,

        )
    )
))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Chains MCMC chain (1000×23×1 Array{Float64, 3}):

Iterations        = 1:1:1000
Number of chains  = 1
Samples per chain = 1000
Wall duration     = 11.07 seconds
Compute duration  = 11.07 seconds
parameters        = plx, b_M, b_a, b_e, b_i, b_ωx, b_ωy, b_Ωx, b_Ωy, b_θx, b_θy, b_ω, b_Ω, b_θ, b_plx, b_tp, b_GPI_astrom_jitter, b_GPI_astrom_northangle, b_GPI_astrom_platescale, b_SPHERE_astrom_jitter, b_SPHERE_astrom_northangle, b_SPHERE_astrom_platescale
internals         = logpost

Summary Statistics
 <span class="sgr1">                 parameters         mean         std      mcse    ess_bulk    ⋯
 <span class="sgr90">                     Symbol      Float64     Float64   Float64     Float64    ⋯

                         plx      50.0084      0.0214    0.0007    943.7139    ⋯
                         b_M       1.2562      0.0605    0.0019   1019.3829    ⋯
                         b_a      11.3116      0.6168    0.0195   1013.1718    ⋯
                         b_e       0.1410      0.0398    0.0013    975.3201    ⋯
                         b_i       0.6879      0.0457    0.0015    921.4344    ⋯
                        b_ωx       0.5171      0.2030    0.0067    918.7257    ⋯
                        b_ωy       0.7880      0.2060    0.0068    947.6862    ⋯
                        b_Ωx       0.9741      0.1211    0.0039    969.0963    ⋯
                        b_Ωy       0.2831      0.1962    0.0063    938.8704    ⋯
                        b_θx       0.0772      0.0152    0.0005    886.3637    ⋯
                        b_θy      -0.9739      0.0529    0.0017    961.4858    ⋯
                         b_ω       0.9795      0.2850    0.0093    914.5466    ⋯
                         b_Ω       0.2905      0.2152    0.0069    961.4665    ⋯
                         b_θ      -1.4916      0.0152    0.0005    911.8094    ⋯
                       b_plx      50.0084      0.0214    0.0007    943.7139    ⋯
                        b_tp   43065.5732   1563.0421   50.1991    941.2678    ⋯
         b_GPI_astrom_jitter       2.4013      0.6779    0.0216    984.4281    ⋯
              ⋮                    ⋮            ⋮          ⋮          ⋮        ⋱
</span><span class="sgr36">                                                    3 columns and 5 rows omitted

Quantiles
                  parameters         2.5%        25.0%        50.0%        75. ⋯
 </span><span class="sgr90">                     Symbol      Float64      Float64      Float64      Float ⋯

                         plx      49.9647      49.9886      50.0106      50.02 ⋯
                         b_M       1.1070       1.2175       1.2706       1.30 ⋯
                         b_a      10.2305      10.9996      11.3098      11.30 ⋯
                         b_e       0.0684       0.1116       0.1589       0.16 ⋯
                         b_i       0.6052       0.6656       0.6803       0.70 ⋯
                        b_ωx       0.2105       0.4427       0.5513       0.55 ⋯
                        b_ωy       0.1478       0.7381       0.7381       0.92 ⋯
                        b_Ωx       0.6696       0.8679       0.9983       1.10 ⋯
                        b_Ωy       0.0947       0.1220       0.2317       0.45 ⋯
                        b_θx       0.0272       0.0664       0.0780       0.09 ⋯
                        b_θy      -1.0710      -1.0033      -0.9777      -0.93 ⋯
                         b_ω       0.1503       0.9293       0.9293       1.11 ⋯
                         b_Ω       0.0934       0.1102       0.2281       0.48 ⋯
                         b_θ      -1.5447      -1.5004      -1.4949      -1.47 ⋯
                       b_plx      49.9647      49.9886      50.0106      50.02 ⋯
                        b_tp   38147.2287   42715.5974   42715.5974   44320.61 ⋯
         b_GPI_astrom_jitter       0.9629       1.9688       2.7774       2.77 ⋯
              ⋮                    ⋮            ⋮            ⋮            ⋮    ⋱
</span><span class="sgr36">                                                    2 columns and 5 rows omitted
</span></span></code></pre><div class="admonition is-warning" id="Warning-96d98704fb66f90f"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-96d98704fb66f90f" title="Permalink"></a></header><div class="admonition-body"><p>Never initialize a value on the bounds of the prior. For example, exactly 0.00000 eccentricity is disallowed by the <code>Uniform(0,1)</code> prior. </p></div></div><h3 id="Visualize-the-starting-points"><a class="docs-heading-anchor" href="#Visualize-the-starting-points">Visualize the starting points</a><a id="Visualize-the-starting-points-1"></a><a class="docs-heading-anchor-permalink" href="#Visualize-the-starting-points" title="Permalink"></a></h3><p>Plot the inital values to make sure that they are reasonable, and match your data. This is a great time to confirm that your data were entered in correctly.</p><pre><code class="language- hljs">using CairoMakie
octoplot(model, init_chain)</code></pre><p>The starting points for sampling look reasonable!</p><div class="admonition is-info" id="Note-236b0856496d4faf"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-236b0856496d4faf" title="Permalink"></a></header><div class="admonition-body"><p>The return value from <code>initialize!</code> is a &quot;variational approximation&quot;. You can pass that chain to any function expecting a <code>chain</code> argument, like <code>Octofitter.savechain</code> or <code>octocorner</code>. It gives a very rough approximation of the posterior we expect.</p></div></div><h3 id="Sampling"><a class="docs-heading-anchor" href="#Sampling">Sampling</a><a id="Sampling-1"></a><a class="docs-heading-anchor-permalink" href="#Sampling" title="Permalink"></a></h3><p>Now we are ready to draw samples from the posterior:</p><pre><code class="language-julia hljs">chain = octofit(model, iterations=1000)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Chains MCMC chain (1000×35×1 Array{Float64, 3}):

Iterations        = 1:1:1000
Number of chains  = 1
Samples per chain = 1000
Wall duration     = 4.74 seconds
Compute duration  = 4.74 seconds
parameters        = plx, b_M, b_a, b_e, b_i, b_ωx, b_ωy, b_Ωx, b_Ωy, b_θx, b_θy, b_ω, b_Ω, b_θ, b_plx, b_tp, b_GPI_astrom_jitter, b_GPI_astrom_northangle, b_GPI_astrom_platescale, b_SPHERE_astrom_jitter, b_SPHERE_astrom_northangle, b_SPHERE_astrom_platescale
internals         = n_steps, is_accept, acceptance_rate, hamiltonian_energy, hamiltonian_energy_error, max_hamiltonian_energy_error, tree_depth, numerical_error, step_size, nom_step_size, is_adapt, loglike, logpost, tree_depth, numerical_error

Summary Statistics
 <span class="sgr1">                 parameters         mean         std       mcse    ess_bulk   ⋯
 <span class="sgr90">                     Symbol      Float64     Float64    Float64     Float64   ⋯

                         plx      49.9999      0.0207     0.0007    941.5834   ⋯
                         b_M       1.1867      0.0925     0.0032    818.4873   ⋯
                         b_a      11.9490      3.2368     0.4596     73.3498   ⋯
                         b_e       0.1207      0.1073     0.0105    152.1513   ⋯
                         b_i       0.6461      0.1677     0.0189     79.1319   ⋯
                        b_ωx       0.0123      0.7109     0.0543    187.1045   ⋯
                        b_ωy       0.0073      0.7291     0.0741    110.8901   ⋯
                        b_Ωx       0.0118      0.8011     0.3120      8.6351   ⋯
                        b_Ωy       0.0435      0.6192     0.1803     18.1058   ⋯
                        b_θx       0.0746      0.0210     0.0007    987.8003   ⋯
                        b_θy      -1.0032      0.1020     0.0036    830.1480   ⋯
                         b_ω      -0.3176      1.7706     0.1639    139.7921   ⋯
                         b_Ω      -0.6407      1.7404     0.4804     27.1892   ⋯
                         b_θ      -1.4966      0.0192     0.0006   1105.8864   ⋯
                       b_plx      49.9999      0.0207     0.0007    941.5834   ⋯
                        b_tp   44000.5848   3695.1787   219.2767    285.1542   ⋯
         b_GPI_astrom_jitter       2.5395      1.9707     0.0515   1245.9861   ⋯
              ⋮                    ⋮            ⋮          ⋮           ⋮       ⋱
</span><span class="sgr36">                                                    3 columns and 5 rows omitted

Quantiles
                  parameters         2.5%        25.0%        50.0%        75. ⋯
 </span><span class="sgr90">                     Symbol      Float64      Float64      Float64      Float ⋯

                         plx      49.9552      49.9865      50.0000      50.01 ⋯
                         b_M       1.0163       1.1213       1.1825       1.24 ⋯
                         b_a       8.2182      10.3011      11.0706      12.78 ⋯
                         b_e       0.0046       0.0411       0.0878       0.17 ⋯
                         b_i       0.2991       0.5372       0.6452       0.75 ⋯
                        b_ωx      -1.0602      -0.6692       0.0142       0.69 ⋯
                        b_ωy      -1.0815      -0.6889      -0.0778       0.72 ⋯
                        b_Ωx      -1.0934      -0.8311       0.0872       0.82 ⋯
                        b_Ωy      -1.0009      -0.4789       0.1250       0.57 ⋯
                        b_θx       0.0374       0.0596       0.0747       0.08 ⋯
                        b_θy      -1.2206      -1.0650      -0.9978      -0.93 ⋯
                         b_ω      -2.9932      -2.0286      -0.1367       1.12 ⋯
                         b_Ω      -2.9650      -2.5470       0.1793       0.65 ⋯
                         b_θ      -1.5336      -1.5099      -1.4965      -1.48 ⋯
                       b_plx      49.9552      49.9865      50.0000      50.01 ⋯
                        b_tp   36220.3712   41703.5474   44515.1470   46618.17 ⋯
         b_GPI_astrom_jitter       0.0853       0.9193       2.1126       3.69 ⋯
              ⋮                    ⋮            ⋮            ⋮            ⋮    ⋱
</span><span class="sgr36">                                                    2 columns and 5 rows omitted
</span></span></code></pre><p>You will get an output that looks something like this with a progress bar that updates every second or so. You can reduce or completely silence the output by reducing the <code>verbosity</code> value down to 0 from a default of 2 (or get more info with <code>verbosity=4</code>).</p><p>Once complete, the <code>chain</code> object will hold the posterior samples. Displaying it prints out a summary table like the one shown above.</p><p>For a basic model like this with few epochs and well-specified uncertainties, sampling should take less than a minute on a typical laptop.</p><p>Sampling can take much longer when you have measurements with very small uncertainties (e.g. VLTI-GRAVITY).</p><h3 id="Diagnostics"><a class="docs-heading-anchor" href="#Diagnostics">Diagnostics</a><a id="Diagnostics-1"></a><a class="docs-heading-anchor-permalink" href="#Diagnostics" title="Permalink"></a></h3><p>The first thing you should do with your results is check a few diagnostics to make sure the sampler converged as intended.</p><p>A few things to watch out for: check that you aren&#39;t getting many numerical errors (<code>ratio_divergent_transitions</code>).  This likely indicates a problem with your model: either invalid values of one or more parameters are encountered (e.g. the prior on semi-major axis includes negative values) or that there is a region of very high curvature that is failing to sample properly. This latter issue can lead to a bias in your results.</p><p>One common mistake is to use a distribution like <code>Normal(10,3)</code> for semi-major axis. This left tail of this distribution includes negative values, and our orbit model is not defined for negative semi-major axes. A better choice is a <code>truncated(Normal(10,3), lower=0.1)</code> distribution (not including zero, since a=0 is not defined).</p><p>Next, you can make a trace plot of different variabes to visually inspect the chain:</p><pre><code class="language-julia hljs">using CairoMakie
lines(
    chain[&quot;b_a&quot;][:],
    axis=(;
        xlabel=&quot;iteration&quot;,
        ylabel=&quot;semi-major axis (AU)&quot;
    )
)</code></pre><img src="a4b0c03e.png" alt="Example block output"/><p>And an auto-correlation plot:</p><pre><code class="language-julia hljs">using StatsBase
using CairoMakie
lines(
    autocor(chain[&quot;b_e&quot;][:], 1:500),
    axis=(;
        xlabel=&quot;lag&quot;,
        ylabel=&quot;autocorrelation&quot;,
    )
)</code></pre><img src="2bb424ed.png" alt="Example block output"/><p>This plot shows that these samples are not correlated after only about 5 iterations. No thinning is necessary.</p><p>To confirm convergence, you may also examine the <code>rhat</code> column from chains. This diagnostic approaches 1 as the chains converge and should at the very least equal <code>1.0</code> to one significant digit (3 recommended).</p><p>Finaly, you might consider running multiple chains. Simply run <code>octofit</code> multiple times, and store the result in different variables. Then you can combine the chains using <code>chainscat</code> and run additional inter-chain convergence diagnostics:</p><pre><code class="language-julia hljs">using MCMCChains
chain1 = octofit(model)
chain2 = octofit(model)
chain3 = octofit(model)
merged_chains = chainscat(chain1, chain2, chain3)
gelmandiag(merged_chains)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Gelman, Rubin, and Brooks diagnostic
 <span class="sgr1">                 parameters      psrf    psrfci
 <span class="sgr90">                     Symbol   Float64   Float64

                         plx    1.0009    1.0025
                         b_M    1.0026    1.0095
                         b_a    1.1098    1.2087
                         b_e    1.0375    1.0946
                         b_i    1.0162    1.0357
                        b_ωx    0.9998    1.0004
                        b_ωy    1.0257    1.0899
                        b_Ωx    1.1833    1.5499
                        b_Ωy    1.0852    1.2723
                        b_θx    1.0018    1.0044
                        b_θy    0.9996    0.9998
                         b_ω    1.0201    1.0716
                         b_Ω    1.1122    1.3513
                         b_θ    1.0009    1.0032
                       b_plx    1.0009    1.0025
                        b_tp    1.0033    1.0105
         b_GPI_astrom_jitter    1.0023    1.0075
              ⋮                   ⋮         ⋮
</span><span class="sgr36">                                    5 rows omitted
</span></span></code></pre><p>This will check that the means and variances are similar between chains that were initialized at different starting points.</p><h3 id="Analysis"><a class="docs-heading-anchor" href="#Analysis">Analysis</a><a id="Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Analysis" title="Permalink"></a></h3><p>As a first pass, let&#39;s plot a sample of orbits drawn from the posterior. The function <code>octoplot</code> is a conveninient way to generate a 9-panel plot of velocities and position:</p><pre><code class="language- hljs">using CairoMakie
octoplot(model,merged_chains)</code></pre><p>This function draws orbits from the posterior and displays them in a plot. Any astrometry points are overplotted. </p><p>You can control what panels are displayed, the time range, colourscheme, etc. See the documentation on <code>octoplot</code> for more details.</p><h3 id="Pair-Plot"><a class="docs-heading-anchor" href="#Pair-Plot">Pair Plot</a><a id="Pair-Plot-1"></a><a class="docs-heading-anchor-permalink" href="#Pair-Plot" title="Permalink"></a></h3><p>A very useful visualization of our results is a pair-plot, or corner plot. We can use the <code>octocorner</code> function and our PairPlots.jl package for this purpose:</p><pre><code class="language-julia hljs">using CairoMakie
using PairPlots
octocorner(model, merged_chains, small=true)</code></pre><img src="a53feb05.png" alt="Example block output"/><p>Remove <code>small=true</code> to display all variables.</p><p>In this case, the sampler was able to resolve the complicated degeneracies between eccentricity, the longitude of the ascending node, and argument of periapsis.</p><h3 id="Saving-your-chain"><a class="docs-heading-anchor" href="#Saving-your-chain">Saving your chain</a><a id="Saving-your-chain-1"></a><a class="docs-heading-anchor-permalink" href="#Saving-your-chain" title="Permalink"></a></h3><p>Variables can be retrieved from the chains using the following sytnax: <code>sma_planet_b = chain[&quot;b_a&quot;,:,:]</code>. The first index is a string or symbol giving the name of the variable in the model. Planet variables are prepended by the name of the planet and an underscore.</p><p>You can save your chain in FITS table format by running:</p><pre><code class="language-julia hljs">Octofitter.savechain(&quot;mychain.fits&quot;, chain)</code></pre><p>You can load it back via:</p><pre><code class="language-julia hljs">chain = Octofitter.loadchain(&quot;mychain.fits&quot;)</code></pre><h3 id="Saving-your-model"><a class="docs-heading-anchor" href="#Saving-your-model">Saving your model</a><a id="Saving-your-model-1"></a><a class="docs-heading-anchor-permalink" href="#Saving-your-model" title="Permalink"></a></h3><p>You may choose to save your model so that you can reload it later to make plots, etc:</p><pre><code class="language-julia hljs">using Serialization
serialize(&quot;model1.jls&quot;, model)</code></pre><p>Which can then be loaded at a later time using:</p><pre><code class="language-julia hljs">using Serialization
using Octofitter # must include all the same imports as your original script
model = deserialize(&quot;model1.jls&quot;)</code></pre><div class="admonition is-warning" id="Warning-874f90810b48b375"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-874f90810b48b375" title="Permalink"></a></header><div class="admonition-body"><p>Serialized models are only loadable/restorable on the same computer, version of Octofitter, and version of Julia. They are not intended for long-term archiving. For reproducibility, make sure to keep your original model definition script.</p></div></div><h3 id="Comparing-chains"><a class="docs-heading-anchor" href="#Comparing-chains">Comparing chains</a><a id="Comparing-chains-1"></a><a class="docs-heading-anchor-permalink" href="#Comparing-chains" title="Permalink"></a></h3><p>We can compare two different chains by passing them both to <code>octocorner</code>. Let&#39;s compare the <code>init_chain</code> with the full results from <code>octofit</code>:</p><pre><code class="language-julia hljs">octocorner(model, chain, init_chain, small=true)</code></pre><img src="28351a8d.png" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../migration/">« Migration Guide</a><a class="docs-footer-nextpage" href="../rel-astrom-obs/">Observable Priors »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Wednesday 6 August 2025 02:49">Wednesday 6 August 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
