<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Astrometry, PMA, and RV · Octofitter.jl</title><meta name="title" content="Astrometry, PMA, and RV · Octofitter.jl"/><meta property="og:title" content="Astrometry, PMA, and RV · Octofitter.jl"/><meta property="twitter:title" content="Astrometry, PMA, and RV · Octofitter.jl"/><meta name="description" content="Documentation for Octofitter.jl."/><meta property="og:description" content="Documentation for Octofitter.jl."/><meta property="twitter:description" content="Documentation for Octofitter.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="Octofitter.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">Octofitter.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../quick-start/">Quick Start</a></li><li><a class="tocitem" href="../faq/">FAQ</a></li><li><a class="tocitem" href="../migration/">Migration Guide</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Relative Astrometry</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../rel-astrom/">Basic Astrom Fit</a></li><li><a class="tocitem" href="../rel-astrom-obs/">Observable Priors</a></li><li><a class="tocitem" href="../fit-coplanar/">Resonant Co-Planar Model</a></li><li><a class="tocitem" href="../thiele-innes/">Thiele-Innes Parameters</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Radial Velocity</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../rv-1/">Basic RV Fit</a></li><li><a class="tocitem" href="../rv-gp/">Gaussian Process</a></li><li><a class="tocitem" href="../rv-multi-planet/">Multiple Planets</a></li><li><a class="tocitem" href="../fit-rv-rel/">Relative RV Data</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Absolute Astrometry</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../pma/">Proper Motion Anomaly</a></li><li><a class="tocitem" href="../hipparcos/">Hipparcos IAD</a></li><li><a class="tocitem" href="../g23h/">Joint Gaia-Hipparcos (G23H)</a></li><li><a class="tocitem" href="../g23h-example/">G23H Full Example</a></li><li><a class="tocitem" href="../gaia-iad/">Gaia DR4 Epoch Astrometry</a></li><li><a class="tocitem" href="../gaia-dr4-simulation/">Gaia DR4 Simulation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Images and More</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../images/">Image Data (de-orbiting)</a></li><li><a class="tocitem" href="../extract-phot-astrom/">Extract Astrom. and Photometry</a></li><li><a class="tocitem" href="../mass-photometry/">Connect Mass and Photometry</a></li><li><a class="tocitem" href="../fit-interfere/">Interferometer Data</a></li><li><a class="tocitem" href="../fit-likemap/">Likelihood Map</a></li><li><a class="tocitem" href="../fit-grav-wide/">GRAVITY Wide Data</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox" checked/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Joint Models</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Astrometry, PMA, and RV</a><ul class="internal"><li><a class="tocitem" href="#Model:-PMA-Only"><span>Model: PMA Only</span></a></li><li><a class="tocitem" href="#Model:-PMA-and-Relative-Astrometry"><span>Model: PMA &amp; Relative Astrometry</span></a></li><li><a class="tocitem" href="#Model:-PMA-and-Relative-Astrometry-and-RVs"><span>Model: PMA &amp; Relative Astrometry &amp; RVs</span></a></li><li><a class="tocitem" href="#Model:-Relative-Astrometry-and-RVs-(no-PMA)"><span>Model:  Relative Astrometry &amp; RVs (no PMA)</span></a></li><li><a class="tocitem" href="#Model-Comparison"><span>Model Comparison</span></a></li></ul></li><li><a class="tocitem" href="../fit-rv-astrom/">RV and Relative Astrometry</a></li><li><a class="tocitem" href="../rv/">RV and Proper Motion Anomaly</a></li><li><a class="tocitem" href="../limits/">Calculate Detection Limits</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6" type="checkbox"/><label class="tocitem" for="menuitem-3-6"><span class="docs-label">Bayesian Workflows</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../eccentric-or-circular/">Circular or Eccentric? Model Comparison</a></li><li><a class="tocitem" href="../data-simulation/">Generating and Fitting Simulated Data</a></li><li><a class="tocitem" href="../prior-pred/">Prior Predictive Checks</a></li><li><a class="tocitem" href="../post-pred/">Posterior Predictive Checks</a></li><li><a class="tocitem" href="../cross-validation/">Cross Validation</a></li><li><a class="tocitem" href="../sbc/">Simulation Based Calibration</a></li></ul></li></ul></li><li><span class="tocitem">Documentation</span><ul><li><a class="tocitem" href="../python/">Using Python</a></li><li><a class="tocitem" href="../chains/">Chains</a></li><li><a class="tocitem" href="../octoplot/">Orbit plots with <code>octoplot</code></a></li><li><a class="tocitem" href="../rvpostplot/">RV plots with <code>rvpostplot</code></a></li><li><a class="tocitem" href="../loading-saving/">Loading and Saving Data</a></li><li><a class="tocitem" href="../samplers/">Sampler</a></li><li><a class="tocitem" href="../parallel-sampling/">Distributed Sampling</a></li><li><a class="tocitem" href="../priors/">Priors</a></li><li><a class="tocitem" href="../derived/">Derived Variables</a></li><li><a class="tocitem" href="../custom-likelihood/">Custom Likelihoods</a></li><li><a class="tocitem" href="../kepler/">Kepler Solver</a></li><li><a class="tocitem" href="../compat-orbitize/">Orbitize! Compatibility</a></li><li><a class="tocitem" href="../api/">Full API Documentation</a></li></ul></li><li><span class="tocitem">Developer Documentation</span><ul><li><a class="tocitem" href="../dev/architecture/">Architecture Overview</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li><a class="is-disabled">Joint Models</a></li><li class="is-active"><a href>Astrometry, PMA, and RV</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Astrometry, PMA, and RV</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/sefffal/Octofitter.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/sefffal/Octofitter.jl/blob/main/docs/src/astrom-pma-rv.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="astrom-pma-rv"><a class="docs-heading-anchor" href="#astrom-pma-rv">Fit Proper Motion Anomaly</a><a id="astrom-pma-rv-1"></a><a class="docs-heading-anchor-permalink" href="#astrom-pma-rv" title="Permalink"></a></h1><p>Octofitter.jl supports fitting orbit models to astrometric motion in the form of GAIA-Hipparcos proper motion anomaly (HGCA; <a href="https://arxiv.org/abs/2105.11662">https://arxiv.org/abs/2105.11662</a>). These data points are calculated by finding the difference between a long term proper motion of a star between the Hipparcos and GAIA catalogs, and their proper motion calculated within the windows of each catalog. This gives four data points that can constrain the dynamical mass &amp; orbits of planetary companions (assuming we subtract out the net trend).</p><p>If your star of interest is in the HGCA, all you need is it&#39;s GAIA DR3 ID number. You can find this number by searching for your target on <a href="http://simbad.cds.unistra.fr">SIMBAD</a>.</p><p>For this tutorial, we will examine the star and companion <a href="https://arxiv.org/abs/2109.12124">HD 91312 A &amp; B</a> discovered by SCExAO. We will use their published astrometry and proper motion anomaly extracted from the HGCA.</p><p>We will also perform a model comparison: we will fit the same model to four different subsets of data to see how each dataset are impacting the final constraints. This is an important consistency check, especially with proper motion / absolute astrometry data which be susceptible to systematic errors.</p><p>The first step is to find the GAIA source ID for your object. For HD 91312, SIMBAD tells us the GAIA DR3 ID is <code>756291174721509376</code>.</p><ul><li><a href="#astrom-pma-rv">Fit Proper Motion Anomaly</a></li><li class="no-marker"><ul><li><a href="#Model:-PMA-Only">Model: PMA Only</a></li><li class="no-marker"><ul><li><a href="#Retrieving-the-HGCA">Retrieving the HGCA</a></li><li><a href="#Planet-Model">Planet Model</a></li><li><a href="#System-Model-and-Specifying-Proper-Motion-Anomaly">System Model &amp; Specifying Proper Motion Anomaly</a></li><li><a href="#Sampling-from-the-posterior-(PMA-only)">Sampling from the posterior (PMA only)</a></li><li><a href="#Pair-Plot">Pair Plot</a></li></ul></li><li><a href="#Model:-PMA-and-Relative-Astrometry">Model: PMA &amp; Relative Astrometry</a></li><li><a href="#Model:-PMA-and-Relative-Astrometry-and-RVs">Model: PMA &amp; Relative Astrometry &amp; RVs</a></li><li><a href="#Model:-Relative-Astrometry-and-RVs-(no-PMA)">Model:  Relative Astrometry &amp; RVs (no PMA)</a></li><li><a href="#Model-Comparison">Model Comparison</a></li></ul></li></ul><h2 id="Model:-PMA-Only"><a class="docs-heading-anchor" href="#Model:-PMA-Only">Model: PMA Only</a><a id="Model:-PMA-Only-1"></a><a class="docs-heading-anchor-permalink" href="#Model:-PMA-Only" title="Permalink"></a></h2><p>Initial setup:</p><pre><code class="language-julia hljs">using Octofitter, Distributions, Random</code></pre><p>We begin by finding orbits that are consistent with the astrometric motion. Later, we will add in relative astrometry to the fit from direct imaging to further constrain the planet&#39;s orbit and mass.</p><p>Compared to previous tutorials, we will now have to add a few additional variables to our model. The first is a prior on the mass of the companion, called <code>mass</code>. The units used on this variable are Jupiter masses, in contrast to <code>M</code>, the primary&#39;s mass, in solar masses.  A reasonable uninformative prior for <code>mass</code> is <code>Uniform(0,1000)</code> or <code>LogUniform(1,1000)</code> depending on the situation.</p><p>For this model, we also want to place a prior on the host star mass rather than system total mass. For exoplanets there is litte difference between these two values, but in this example we have a reasonably informative prior on the host mass, and know from the paper that the companion is has a non-neglible effect on the total system mass.</p><p>To make this parameterization change, we specify priors on both masses in the <code>@system</code> block, and connect it to the planet.</p><h3 id="Retrieving-the-HGCA"><a class="docs-heading-anchor" href="#Retrieving-the-HGCA">Retrieving the HGCA</a><a id="Retrieving-the-HGCA-1"></a><a class="docs-heading-anchor-permalink" href="#Retrieving-the-HGCA" title="Permalink"></a></h3><p>To start, we retrieve the HGCA data for this object.</p><pre><code class="language-julia hljs">hgca_obs = HGCAObs(
    gaia_id=756291174721509376,
    variables=@variables begin
        # Optional: flux ratio for luminous companions
        # fluxratio ~ Product([Uniform(0, 1), Uniform(0, 1), ])  # uncomment if needed for unresolved companions
    end
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">HGCAObs Table with 6 columns and 6 rows:
     epoch    start_epoch  stop_epoch  pm        σ_pm       kind
   ┌────────────────────────────────────────────────────────────────
 1 │ 48345.3  47878.5      48932.8     -141.885  0.576791   ra_hip
 2 │ 48500.4  47878.5      48932.8     8.07173   0.375164   dec_hip
 3 │ 52884.2  48345.3      57423.2     -137.653  0.0195449  ra_hg
 4 │ 53001.6  48500.4      57503.1     1.88969   0.0126896  dec_hg
 5 │ 57423.2  56949.9      57520.6     -136.291  0.153744   ra_gaia
 6 │ 57503.1  56949.9      57520.6     1.77352   0.189044   dec_gaia</code></pre><p>You can optionally provide flux ratio priors in the variables block to represent the flux ratio of the companions to the host star. This is used to account for photocentre offsets caused by luminous companions. For typical exoplanets this can often just be set to <code>0</code> in the planet model definition, since they are so dim compared to the star.</p><h3 id="Planet-Model"><a class="docs-heading-anchor" href="#Planet-Model">Planet Model</a><a id="Planet-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Planet-Model" title="Permalink"></a></h3><pre><code class="language-julia hljs">planet_b = Planet(
    name=&quot;b&quot;,
    basis=Visual{KepOrbit},
    variables=@variables begin
        a ~ LogUniform(0.1,20)
        e ~ Uniform(0,0.999)
        ω ~ Uniform(0, 2pi)
        i ~ Sine() # The Sine() distribution is defined by Octofitter
        Ω ~ Uniform(0, 2pi)

        mass = system.M_sec

        θ ~ Uniform(0, 2pi)
        M = system.M
        tp = θ_at_epoch_to_tperi(θ, 57423.0; M, e, a, i, ω, Ω) # epoch of GAIA measurement

        F = 0.0 # optional: set gaia flux ratio of secondary to host
    end
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Planet b
Derived:
                  mass = system.M_sec
                   M = system.M
                  tp = θ_at_epoch_to_tperi(θ, 57423.0; M, e, a, i, ω, Ω)
                   F = 0.0

Priors:
                   a ~ Distributions.LogUniform{Float64}(a=0.1, b=20.0)
                   e ~ Distributions.Uniform{Float64}(a=0.0, b=0.999)
                   ω ~ Distributions.Uniform{Float64}(a=0.0, b=6.283185307179586)
                   i ~ Sine()
                   Ω ~ Distributions.Uniform{Float64}(a=0.0, b=6.283185307179586)
                   θ ~ Distributions.Uniform{Float64}(a=0.0, b=6.283185307179586)


</code></pre><h3 id="System-Model-and-Specifying-Proper-Motion-Anomaly"><a class="docs-heading-anchor" href="#System-Model-and-Specifying-Proper-Motion-Anomaly">System Model &amp; Specifying Proper Motion Anomaly</a><a id="System-Model-and-Specifying-Proper-Motion-Anomaly-1"></a><a class="docs-heading-anchor-permalink" href="#System-Model-and-Specifying-Proper-Motion-Anomaly" title="Permalink"></a></h3><p>Now that we have our planet model, we create a system model to contain it.</p><p>We specify priors on <code>plx</code> as usual, but here we use the <code>gaia_plx</code> helper function to read the parallax and uncertainty directly from the HGCA catalog using its source ID.</p><p>We also add parameters for the star&#39;s long term proper motion. This is usually close to the long term trend between the Hipparcos and GAIA measurements.</p><div class="admonition is-warning" id="Use-wide-priors-for-pmra/pmdec-with-HGCA-data-720b2c5b4bed915a"><header class="admonition-header">Use wide priors for pmra/pmdec with HGCA data<a class="admonition-anchor" href="#Use-wide-priors-for-pmra/pmdec-with-HGCA-data-720b2c5b4bed915a" title="Permalink"></a></header><div class="admonition-body"><p>When fitting HGCA data, use <strong>wide, uninformative priors</strong> for <code>pmra</code> and <code>pmdec</code>, such as <code>Normal(0, 1000)</code> (0 ± 1000 mas/yr). <strong>Do not</strong> use Gaia DR3 proper motion values as informative priors—this would double-count the information since the HGCA already incorporates Gaia astrometry and will constrain the system&#39;s proper motion through the likelihood. The pmra/pmdec parameters represent the center-of-mass proper motion, which the HGCA measurements help determine.</p><p>The example below uses <code>Normal(-137, 10)</code> only because we have independent prior knowledge of this system&#39;s proper motion from other sources—for a typical analysis, you should use wide priors like <code>Normal(0, 1000)</code>.</p></div></div><pre><code class="language-julia hljs">sys = System(
    name=&quot;HD91312_pma&quot;,
    companions=[planet_b],
    observations=[hgca_obs],
    variables=@variables begin
        M_pri ~ truncated(Normal(1.61, 0.1), lower=0.1) # Msol
        M_sec ~ LogUniform(0.5, 1000) # MJup
        M = M_pri + M_sec*Octofitter.mjup2msol # Msol

        plx ~ gaia_plx(gaia_id=756291174721509376)

        # Priors on the center of mass proper motion
        pmra ~ Normal(-137, 10)
        pmdec ~ Normal(2,  10)
    end
)

model_pma = Octofitter.LogDensityModel(sys)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">LogDensityModel for System HD91312_pma of dimension 11 and 6 epochs with fields .ℓπcallback and .∇ℓπcallback
</code></pre><p>After the priors, we add the proper motion anomaly measurements from the HGCA. If this is your first time running this code, you will be prompted to automatically download and cache the catalog which may take around 30 seconds.</p><h3 id="Sampling-from-the-posterior-(PMA-only)"><a class="docs-heading-anchor" href="#Sampling-from-the-posterior-(PMA-only)">Sampling from the posterior (PMA only)</a><a id="Sampling-from-the-posterior-(PMA-only)-1"></a><a class="docs-heading-anchor-permalink" href="#Sampling-from-the-posterior-(PMA-only)" title="Permalink"></a></h3><p>Because proper motion anomaly data is quite sparse, it can often produce multi-modal posteriors. If your orbit already has several relative astrometry or RV data points, this is less of an issue. But in many cases it is recommended to use the <code>Pigeons.jl</code> sampler instead of Octofitter&#39;s default. This sampler is less efficient for unimodal distributions, but is more robust at exploring posteriors with distinct, widely separated peaks. </p><p>To install and use <code>Pigeons.jl</code> with Octofitter, type <code>using Pigeons</code> at in the terminal and accept the prompt to install the package. You may have to restart Julia.</p><div class="admonition is-info" id="Note-885630c21c612562"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-885630c21c612562" title="Permalink"></a></header><div class="admonition-body"><p><code>octofit_pigeons</code> scales very well across multiple cores. Start julia with <code>julia --threads=auto</code> to make sure you have multiple threads available for sampling.</p></div></div><p>We now sample from our model using Pigeons:</p><pre><code class="language-julia hljs">using Pigeons
chain_pma, pt = octofit_pigeons(model_pma, n_rounds=8, explorer=SliceSampler())
display(chain_pma)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌ Warning: Module Octofitter with build ID fafbfcfd-ea60-8d7c-bdfc-481f7ce53163 is missing from the cache.
│ This may mean Octofitter [daf3887e-d01a-44a1-9d7e-98f15c5d69c9] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2018
┌ Warning: Module ForwardDiff with build ID fafbfcfd-29ed-68b3-d051-2916b701d2d6 is missing from the cache.
│ This may mean ForwardDiff [f6369f11-7733-5829-9624-2563aa707210] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2018
[ Info: Sampler running with multiple threads     : true
[ Info: Likelihood evaluated with multiple threads: false
┌ Info: Starting values not provided for all parameters! Guessing starting point using global optimization:
│   num_params = 11
└   num_fixed = 0
┌ Info: Found sample of initial positions
│   logpost_range = (-17.94100650669944, -8.176593499054654)
└   mean_logpost = -10.762978940501343
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
  scans     restarts      Λ        Λ_var      time(s)    allc(B)  log(Z₁/Z₀)   min(α)     mean(α)    min(αₑ)   mean(αₑ)
────────── ────────── ────────── ────────── ────────── ────────── ────────── ────────── ────────── ────────── ──────────
        2          0       1.89       2.71       2.38    2.3e+09  -3.23e+03          0      0.851          1          1
        4          0       5.66       4.29       2.95   3.95e+09  -1.05e+03          0      0.679          1          1
        8          0       7.06        5.3       5.28   7.15e+09       -177  2.38e-147      0.602          1          1
       16          0       7.53       6.46         10   1.36e+10        -12     0.0475      0.549          1          1
       32          0        7.8       7.12       19.5   2.64e+10      -15.7    0.00898      0.519      0.999          1
       64          0       7.26       5.44       41.3   5.57e+10      -34.2      0.202       0.59          1          1
      128          0       7.74       6.23       81.5    1.1e+11      -25.9      0.296      0.549          1          1
      256          5       8.26       6.45        153   2.09e+11      -24.8      0.275      0.526          1          1
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</code></pre><p>Note that <code>octofit_pigeons</code> took somewhat longer to run than <code>octofit</code> typically does; however, as we will see, it sampled successfully from severally completely disconnected modes in the posterior. That makes it a good fit for sampling from proper motion anomaly and relative astrometry with limited orbital coverage.</p><h3 id="Pair-Plot"><a class="docs-heading-anchor" href="#Pair-Plot">Pair Plot</a><a id="Pair-Plot-1"></a><a class="docs-heading-anchor-permalink" href="#Pair-Plot" title="Permalink"></a></h3><p>If we wish to examine the covariance between parameters in more detail, we can construct a pair-plot (aka. corner plot).</p><pre><code class="language-julia hljs"># Create a corner plot / pair plot.
# We can access any property from the chain specified in Variables
using CairoMakie
using PairPlots
octocorner(model_pma, chain_pma, small=true)</code></pre><img src="d54f6ccc.png" alt="Example block output"/><p>Notice how there are completely separated peaks? The default Octofitter sample (Hamiltonian Monte Carlo) is capabale of jumping 2-3σ gaps between modes, but such widely separated peaks can cause issues (hence why we used Pigeons in this example).</p><h2 id="Model:-PMA-and-Relative-Astrometry"><a class="docs-heading-anchor" href="#Model:-PMA-and-Relative-Astrometry">Model: PMA &amp; Relative Astrometry</a><a id="Model:-PMA-and-Relative-Astrometry-1"></a><a class="docs-heading-anchor-permalink" href="#Model:-PMA-and-Relative-Astrometry" title="Permalink"></a></h2><p>The first orbit fit to only Hipparcos/GAIA data was very unconstrained. We will now add six epochs of relative astrometry (measured from direct images) gathered from the <a href="https://arxiv.org/abs/2109.12124">discovery paper</a>.</p><pre><code class="language-julia hljs">astrom_dat = Table(;
    epoch = [mjd(&quot;2016-12-15&quot;), mjd(&quot;2017-03-12&quot;), mjd(&quot;2017-03-13&quot;), mjd(&quot;2018-02-08&quot;), mjd(&quot;2018-11-28&quot;), mjd(&quot;2018-12-15&quot;)],
    ra    = [133., 126., 127., 083., 058., 056.],
    dec   = [-174., -176., -172., -133., -122., -104.],
    σ_ra  = [07.0, 04.0, 04.0, 10.0, 10.0, 08.0],
    σ_dec = [07.0, 04.0, 04.0, 10.0, 20.0, 08.0],
    cor   = [0.2, 0.3, 0.1, 0.4, 0.3, 0.2]
)

astrom_obs = PlanetRelAstromObs(
    astrom_dat,
    name = &quot;SCExAO&quot;,
    variables = @variables begin
        # Fixed values for this example - could be free variables:
        jitter = 0        # mas [could use: jitter ~ Uniform(0, 10)]
        northangle = 0    # radians [could use: northangle ~ Normal(0, deg2rad(1))]
        platescale = 1    # relative [could use: platescale ~ truncated(Normal(1, 0.01), lower=0)]
    end
)
scatter(astrom_obs.table.ra, astrom_obs.table.dec)</code></pre><img src="90fc1411.png" alt="Example block output"/><p>We use the same model as before, but now condition the planet model <code>B</code> on the astrometry data by adding <code>astrom_obs</code> to the list of <code>likelihoods</code> in the planet model.</p><pre><code class="language-julia hljs">using OctofitterRadialVelocity

rv_dat = Table(;
    epoch = [mjd(&quot;2008-05-01&quot;), mjd(&quot;2010-02-15&quot;), mjd(&quot;2016-03-01&quot;)],
    rv    = [1300, 700, -2700],
    σ_rv  = [150, 150, 150]
)

rvlike = PlanetRelativeRVObs(
    rv_dat,
    name=&quot;SOPHIE&quot;,
    variables=@variables begin
        jitter ~ truncated(Normal(10, 5), lower=0)  # m/s [could fix: jitter = 0]
    end
)

planet_b = Planet(
    name=&quot;b&quot;,
    basis=Visual{KepOrbit},
    observations=[ObsPriorAstromONeil2019(astrom_obs)],
    variables=@variables begin
        a ~ LogUniform(0.1,400)
        e ~ Uniform(0,0.999)
        ω ~ Uniform(0, 2pi)
        i ~ Sine()
        Ω ~ Uniform(0, 2pi)

        mass = system.M_sec

        θ ~ Uniform(0, 2pi)
        M = system.M
        tp = θ_at_epoch_to_tperi(θ, 57737.0; M, e, a, i, ω, Ω) # epoch of astrometry

        F = 0.0
    end
)

sys_astrom = System(
    name=&quot;HD91312_pma_astrom&quot;,
    companions=[planet_b],
    observations=[hgca_obs],
    variables=@variables begin
        M_pri ~ truncated(Normal(1.61, 0.1), lower=0.1)
        M_sec ~ LogUniform(0.5, 1000) # MJup
        M = M_pri + M_sec*Octofitter.mjup2msol

        plx ~ gaia_plx(gaia_id=756291174721509376)

        # Priors on the centre of mass proper motion
        pmra ~ Normal(-137, 10)
        pmdec ~ Normal(2,  10)
    end
)

model_pma_astrom = Octofitter.LogDensityModel(sys_astrom,verbosity=4)

using Pigeons
chain_pma_astrom, pt = octofit_pigeons(model_pma_astrom, n_rounds=7, explorer=SliceSampler())</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[ Info: Preparing model
┌ Info: Determined number of free variables
└   D = 11
┌ Info: Determined number type
└   T = Float64
ℓπcallback(θ): 0.000124 seconds (78 allocations: 84.312 KiB)
∇ℓπcallback(θ): 0.000430 seconds (24 allocations: 130.734 KiB)
[ Info: Sampler running with multiple threads     : true
[ Info: Likelihood evaluated with multiple threads: false
┌ Info: Starting values not provided for all parameters! Guessing starting point using global optimization:
│   num_params = 11
└   num_fixed = 0
┌ Info: Found sample of initial positions
│   logpost_range = (-49.6028850997191, -39.054166447713484)
└   mean_logpost = -41.54390106517376
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
  scans     restarts      Λ        Λ_var      time(s)    allc(B)  log(Z₁/Z₀)   min(α)     mean(α)    min(αₑ)   mean(αₑ)
────────── ────────── ────────── ────────── ────────── ────────── ────────── ────────── ────────── ────────── ──────────
        2          0       4.94          2          2   2.33e+09  -5.24e+03          0      0.776          1          1
        4          0       4.13       4.08       3.24   4.26e+09  -1.78e+03          0      0.735          1          1
        8          0       5.62       5.56       6.04   7.99e+09       -246          0      0.639          1          1
       16          0       5.97       7.34       11.3   1.48e+10      -73.3   1.38e-29      0.571          1          1
       32          0       7.66       7.78         21   2.76e+10      -57.2   0.000236      0.502          1          1
       64          3       8.58       4.05       44.3   5.82e+10       -200   4.54e-14      0.593          1          1
      128          2       8.99       4.77       89.8   1.18e+11        -66     0.0306      0.556          1          1
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</code></pre><pre><code class="language-julia hljs">octoplot(model_pma_astrom, chain_pma_astrom)</code></pre><img src="469b1cb4.png" alt="Example block output"/><h2 id="Model:-PMA-and-Relative-Astrometry-and-RVs"><a class="docs-heading-anchor" href="#Model:-PMA-and-Relative-Astrometry-and-RVs">Model: PMA &amp; Relative Astrometry &amp; RVs</a><a id="Model:-PMA-and-Relative-Astrometry-and-RVs-1"></a><a class="docs-heading-anchor-permalink" href="#Model:-PMA-and-Relative-Astrometry-and-RVs" title="Permalink"></a></h2><p>We now add in three additional epochs of stellar RVs.</p><pre><code class="language-julia hljs">using OctofitterRadialVelocity

rv_dat_abs = Table(;
    epoch = [mjd(&quot;2008-05-01&quot;), mjd(&quot;2010-02-15&quot;), mjd(&quot;2016-03-01&quot;)],
    rv    = [1300, 700, -2700],
    σ_rv  = [150, 150, 150]
)

rvlike = StarAbsoluteRVObs(
    rv_dat_abs,
    name=&quot;SOPHIE&quot;,
    variables=@variables begin
        jitter ~ truncated(Normal(10, 5), lower=0)  # m/s
        offset ~ Normal(0, 1000)  # m/s
    end
)

planet_b_rv = Planet(
    name=&quot;b&quot;,
    basis=AbsoluteVisual{KepOrbit},
    observations=[ObsPriorAstromONeil2019(astrom_obs)],
    variables=@variables begin
        a ~ LogUniform(0.1,400)
        e ~ Uniform(0,0.999)
        ω ~ Uniform(0, 2pi)
        i ~ Sine()
        Ω ~ Uniform(0, 2pi)

        mass = system.M_sec

        θ ~ Uniform(0, 2pi)
        M = system.M
        tp = θ_at_epoch_to_tperi(θ, 57737.0; M, e, a, i, ω, Ω) # epoch of astrometry

        F = 0.0
    end
)


ra = 158.30707896392835
dec = 40.42555422701387

sys_rv_astrom = System(
    name=&quot;HD91312_pma_rv_astrom&quot;,
    companions=[planet_b_rv],
    observations=[hgca_obs, rvlike],
    variables=@variables begin
        M_pri ~ truncated(Normal(1.61, 0.1), lower=0.1)
        M_sec ~ LogUniform(0.5, 1000) # MJup
        M = M_pri + M_sec*Octofitter.mjup2msol

        plx ~ gaia_plx(gaia_id=756291174721509376)

        # Priors on the centre of mass proper motion
        pmra ~ Normal(-137, 10)
        pmdec ~ Normal(2,  10)

        ra = $ra
        dec = $dec
        rv = 0*1e3 # m/s
        ref_epoch = Octofitter.meta_gaia_DR3.ref_epoch_mjd
    end
)

model_pma_rv_astrom = Octofitter.LogDensityModel(sys_rv_astrom,verbosity=4)
chain_pma_rv_astrom, pt = octofit_pigeons(model_pma_rv_astrom, n_rounds=7, explorer=SliceSampler())
display(chain_pma_rv_astrom)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[ Info: Preparing model
┌ Info: Determined number of free variables
└   D = 13
┌ Info: Determined number type
└   T = Float64
ℓπcallback(θ): 0.000204 seconds (78 allocations: 84.312 KiB)
∇ℓπcallback(θ): 0.001040 seconds (24 allocations: 152.391 KiB)
[ Info: Sampler running with multiple threads     : true
[ Info: Likelihood evaluated with multiple threads: false
┌ Info: Starting values not provided for all parameters! Guessing starting point using global optimization:
│   num_params = 13
└   num_fixed = 0
┌ Info: Found sample of initial positions
│   logpost_range = (-102.58475643994913, -92.33128280801864)
└   mean_logpost = -94.38092228200986
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
  scans     restarts      Λ        Λ_var      time(s)    allc(B)  log(Z₁/Z₀)   min(α)     mean(α)    min(αₑ)   mean(αₑ)
────────── ────────── ────────── ────────── ────────── ────────── ────────── ────────── ────────── ────────── ──────────
        2          0       3.64          4       4.85   2.66e+09  -3.07e+04          0      0.754          1          1
        4          0       4.48       4.32       8.75   5.09e+09  -1.19e+03          0      0.716          1          1
        8          0       5.51       4.28       16.8   9.78e+09       -503          0      0.684          1          1
       16          0       7.49       6.27       32.4   1.89e+10      -97.5   2.28e-18      0.556          1          1
       32          0       7.81       8.27       62.3   3.64e+10       -108   1.75e-25      0.481      0.999          1
       64          0       8.68       4.67        125   7.27e+10       -113    0.00188      0.569          1          1
      128          3       8.94       4.98        251   1.48e+11      -92.8    0.00909      0.551          1          1
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</code></pre><p>The mass vs. semi-major axis posterior is now much more constrained:</p><pre><code class="language-julia hljs">using CairoMakie, PairPlots
pairplot(
    (; a=chain_pma_rv_astrom[&quot;b_a&quot;][:], mass=chain_pma_rv_astrom[&quot;b_mass&quot;][:]) =&gt;
        (
            PairPlots.Scatter(color=:red,markersize=5),
            PairPlots.MarginHist(),
            PairPlots.MarginQuantileText()
        ),
    labels=Dict(:mass=&gt;&quot;mass [Mⱼᵤₚ]&quot;, :a=&gt;&quot;sma. [au]&quot;),
)</code></pre><img src="df7ab0a4.png" alt="Example block output"/><p>It is now useful to display the orbits projected onto the plane of the sky using <code>octoplot</code>. This function produces a nine-panel figure showing posterior predictive distributions for velocity (in three dimensions), projected positions vs. time in the plane of the sky,  and various other two and three-dimensional views.</p><pre><code class="language-julia hljs">octoplot(model_pma_rv_astrom, chain_pma_rv_astrom, show_mass=true)</code></pre><img src="00c27019.png" alt="Example block output"/><h2 id="Model:-Relative-Astrometry-and-RVs-(no-PMA)"><a class="docs-heading-anchor" href="#Model:-Relative-Astrometry-and-RVs-(no-PMA)">Model:  Relative Astrometry &amp; RVs (no PMA)</a><a id="Model:-Relative-Astrometry-and-RVs-(no-PMA)-1"></a><a class="docs-heading-anchor-permalink" href="#Model:-Relative-Astrometry-and-RVs-(no-PMA)" title="Permalink"></a></h2><p>There is a final model we should consider: one using the RV and astrometry data, but not the proper motion anomaly:</p><pre><code class="language-julia hljs">using OctofitterRadialVelocity

planet_b_final = Planet(
    name=&quot;b&quot;,
    basis=Visual{KepOrbit},
    observations=[ObsPriorAstromONeil2019(astrom_obs)],
    variables=@variables begin
        a ~ LogUniform(0.1,400)
        e ~ Uniform(0,0.999)
        ω ~ Uniform(0, 2pi)
        i ~ Sine()
        Ω ~ Uniform(0, 2pi)

        mass = system.M_sec

        θ ~ Uniform(0, 2pi)
        M = system.M
        tp = θ_at_epoch_to_tperi(θ, 57737.0; M, e, a, i, ω, Ω) # epoch of astrometry
    end
)

sys_final = System(
    name=&quot;HD91312_rv_astrom&quot;,
    companions=[planet_b_final],
    observations=[rvlike],
    variables=@variables begin
        M_pri ~ truncated(Normal(1.61, 0.1), lower=0.1)
        M_sec ~ LogUniform(0.5, 1000) # MJup
        M = M_pri + M_sec*Octofitter.mjup2msol

        plx ~ gaia_plx(gaia_id=756291174721509376)
    end
)

model_rv_astrom = Octofitter.LogDensityModel(sys_final,verbosity=4)

chain_rv_astrom, pt = octofit_pigeons(model_rv_astrom, n_rounds=12)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[ Info: Preparing model
┌ Info: Determined number of free variables
└   D = 11
┌ Info: Determined number type
└   T = Float64
ℓπcallback(θ): 0.000020 seconds
∇ℓπcallback(θ): 0.000035 seconds (1 allocation: 32 bytes)
[ Info: Sampler running with multiple threads     : true
[ Info: Likelihood evaluated with multiple threads: false
┌ Info: Starting values not provided for all parameters! Guessing starting point using global optimization:
│   num_params = 11
└   num_fixed = 0
┌ Info: Found sample of initial positions
│   logpost_range = (-72.51292737110765, -63.040618000571)
└   mean_logpost = -66.14754670132075
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
  scans     restarts      Λ        Λ_var      time(s)    allc(B)  log(Z₁/Z₀)   min(α)     mean(α)    min(αₑ)   mean(αₑ)
────────── ────────── ────────── ────────── ────────── ────────── ────────── ────────── ────────── ────────── ──────────
        2          0       2.36       3.53      0.286   4.14e+06       -831          0       0.81          1          1
        4          0       6.44       5.17      0.174   1.32e+05       -107   5.01e-39      0.626          1          1
        8          0        6.9       5.51      0.329   2.39e+05      -75.2   4.27e-09        0.6          1          1
       16          0       7.27       7.28      0.648   3.75e+05      -73.6     0.0125      0.531          1          1
       32          0       7.71       8.04       1.27   6.16e+05      -74.6      0.181      0.492          1          1
       64          1       7.61       2.67       2.73   5.14e+07      -76.7      0.305      0.668      0.999          1
      128         13       7.13       3.55        5.1   9.07e+07        -75      0.369      0.656          1          1
      256         24       7.75       2.95       10.2   1.79e+08        -75      0.402      0.655          1          1
      512         56       7.62       3.05       20.5   3.58e+08      -75.2      0.424      0.656          1          1
 1.02e+03        114       7.52       3.03       40.9   7.14e+08      -75.2      0.443       0.66          1          1
 2.05e+03        220       7.52       3.03       81.6   1.42e+09      -75.2      0.471      0.659          1          1
  4.1e+03        434        7.5        3.1        163   2.85e+09      -75.3      0.469      0.658          1          1
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</code></pre><pre><code class="language-julia hljs">octoplot(model_rv_astrom, chain_rv_astrom)</code></pre><img src="95a17352.png" alt="Example block output"/><h2 id="Model-Comparison"><a class="docs-heading-anchor" href="#Model-Comparison">Model Comparison</a><a id="Model-Comparison-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Comparison" title="Permalink"></a></h2><p>Let&#39;s now display the constraints provided by each data set in a single corner plot</p><pre><code class="language-julia hljs"># Create a corner plot / pair plot.
using CairoMakie: Makie
using PairPlots
octocorner(
    model_pma,
    chain_pma,
    chain_pma_astrom,
    chain_rv_astrom,
    chain_pma_rv_astrom,
    small=false,
    axis=(;
        b_a = (;lims=(low=0, high=25))
    ),
    viz=(
        PairPlots.MarginDensity(),
        PairPlots.Scatter()
    )
)</code></pre><img src="4a181882.png" alt="Example block output"/><p>We see that the constraints provided by the PMA, the astrometry, and the radial velocity data all individually overlap, and agree with the joint model constraint.  This is means that none of the datasets are in tension with each other, which might suggest an issue with the data or with the modelling assumptions (e.g. single planet). </p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../fit-grav-wide/">« GRAVITY Wide Data</a><a class="docs-footer-nextpage" href="../fit-rv-astrom/">RV and Relative Astrometry »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Saturday 14 February 2026 21:07">Saturday 14 February 2026</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
